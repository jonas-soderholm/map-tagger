{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{useSharedState}from\"../../SharedContext.jsx\";import{v4 as uuidv4}from\"uuid\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function ButtonShareMarkers(){const{sharedMarkers,setSharedMarkers}=useSharedState();const{isSharedLink,setIsSharedLink}=useSharedState();// eslint-disable-next-line no-unused-vars\nconst{markersLoaded,setMarkersLoaded}=useSharedState();const{isMobile}=useSharedState();const{mapArray}=useSharedState();// State for managing modal visibility and the shareable link\nconst[showModal,setShowModal]=useState(false);const[shareableLink,setShareableLink]=useState(\"\");const sendMarkerData=async()=>{const uuidMarkers=uuidv4();const updatedUuidMarkers=sharedMarkers.map(marker=>({...marker,groupId:uuidMarkers}));try{const baseUrl=window.location.origin;console.log(\"Base URL:\",baseUrl);const url=\"\".concat(baseUrl,\"/MarkerInformation\");console.log(\"Request URL:\",url);const response=await fetch(\"/MarkerInformation\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(updatedUuidMarkers)});if(!response.ok){throw new Error(\"HTTP error! status: \".concat(response.status));}// Update the shareable link state and show the modal\n// const link = `http://localhost:3000/shared-markers?groupId=${uuidMarkers}`;\nconst link=\"\".concat(window.location.origin,\"/shared-markers?groupId=\").concat(uuidMarkers);setShareableLink(link);setShowModal(true);// Show the modal with the link\n}catch(error){console.error(\"Error sending marker data:\",error);}};const fetchGroupMarkers=async groupId=>{const url=\"/shared-markers?groupId=\".concat(groupId);console.log(\"fetch marker1\");try{const response=await fetch(url);if(!response.ok){throw new Error(\"HTTP error! status: \".concat(response.status));}console.log(\"fetch marker2\");const text=await response.text();// Get the raw text of the response\nconsole.log(\"Raw response text:\",text);// Parse the text as JSON\nconst data=JSON.parse(text);console.log(\"Received data:\",data);setSharedMarkers(data);setIsSharedLink(true);setMarkersLoaded(true);}catch(error){console.error(\"Error fetching group markers:\",error.message);console.error(\"Error details:\",error);}};useEffect(()=>{const queryParams=new URLSearchParams(window.location.search);const groupId=queryParams.get(\"groupId\");console.log(\"Group ID:\",groupId);if(groupId){fetchGroupMarkers(groupId);console.log(\"asd1\");}else{setMarkersLoaded(true);console.log(\"asd2\");}},[]);// Function to copy the shareable link to clipboard\nconst copyToClipboard=()=>{navigator.clipboard.writeText(shareableLink).then(()=>{// Optional: Display a message or change button text/state to indicate the link was copied\n},err=>{console.error(\"Could not copy text: \",err);});};// Modal\nconst ShareModal=()=>/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-[1007] \",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded-lg shadow-lg flex flex-col items-center\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Here's your shareable link:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",readOnly:true,value:shareableLink,className:\"text-center p-2 border border-gray-300 rounded mt-2\",onClick:e=>e.target.select()}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3 mt-3\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 my-auto  bg-blue-500 text-white rounded hover:bg-blue-700\",onClick:copyToClipboard,children:\"Copy\"}),/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 my-auto  bg-blue-500 text-white rounded hover:bg-blue-700\",onClick:()=>setShowModal(false),children:\"Close\"})]})]})});return/*#__PURE__*/_jsxs(_Fragment,{children:[showModal&&/*#__PURE__*/_jsx(ShareModal,{}),isMobile?/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"button\",{onClick:sendMarkerData,className:\"send-button \".concat(mapArray.length===0?\"hidden\":\"visible\",\" text-xs px-3 text-center my-auto py-2 rounded-full share-button-mobile\"),children:\"Share tags!\"})}):/*#__PURE__*/_jsx(_Fragment,{children:!isSharedLink&&/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center\",children:/*#__PURE__*/_jsx(\"button\",{className:\"share-button-mobile body-font  text-xl backdrop-blur-xl flex px-5 py-4 rounded-full fixed mb-10 p4 bottom-2 mx-auto hover:bg-gray-400 \",onClick:sendMarkerData,children:\"Share tags!\"})})})]});}export default ButtonShareMarkers;","map":{"version":3,"names":["React","useState","useEffect","useSharedState","v4","uuidv4","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ButtonShareMarkers","sharedMarkers","setSharedMarkers","isSharedLink","setIsSharedLink","markersLoaded","setMarkersLoaded","isMobile","mapArray","showModal","setShowModal","shareableLink","setShareableLink","sendMarkerData","uuidMarkers","updatedUuidMarkers","map","marker","groupId","baseUrl","window","location","origin","console","log","url","concat","response","fetch","method","headers","body","JSON","stringify","ok","Error","status","link","error","fetchGroupMarkers","text","data","parse","message","queryParams","URLSearchParams","search","get","copyToClipboard","navigator","clipboard","writeText","then","err","ShareModal","className","children","type","readOnly","value","onClick","e","target","select","length"],"sources":["/home/jonas/web-projects/trash-tagger/frontend/src/components/buttons/ButtonShareMarkers.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useSharedState } from \"../../SharedContext.jsx\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nfunction ButtonShareMarkers() {\n  const { sharedMarkers, setSharedMarkers } = useSharedState();\n  const { isSharedLink, setIsSharedLink } = useSharedState();\n  // eslint-disable-next-line no-unused-vars\n  const { markersLoaded, setMarkersLoaded } = useSharedState();\n  const { isMobile } = useSharedState();\n  const { mapArray } = useSharedState();\n\n  // State for managing modal visibility and the shareable link\n  const [showModal, setShowModal] = useState(false);\n  const [shareableLink, setShareableLink] = useState(\"\");\n\n  const sendMarkerData = async () => {\n    const uuidMarkers = uuidv4();\n    const updatedUuidMarkers = sharedMarkers.map((marker) => ({\n      ...marker,\n      groupId: uuidMarkers,\n    }));\n\n    try {\n      const baseUrl = window.location.origin;\n      console.log(\"Base URL:\", baseUrl);\n\n      const url = `${baseUrl}/MarkerInformation`;\n      console.log(\"Request URL:\", url);\n\n      const response = await fetch(\"/MarkerInformation\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(updatedUuidMarkers),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      // Update the shareable link state and show the modal\n      // const link = `http://localhost:3000/shared-markers?groupId=${uuidMarkers}`;\n      const link = `${window.location.origin}/shared-markers?groupId=${uuidMarkers}`;\n      setShareableLink(link);\n\n      setShowModal(true); // Show the modal with the link\n    } catch (error) {\n      console.error(\"Error sending marker data:\", error);\n    }\n  };\n\n  const fetchGroupMarkers = async (groupId) => {\n    const url = `/shared-markers?groupId=${groupId}`;\n    console.log(\"fetch marker1\");\n\n    try {\n      const response = await fetch(url);\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      console.log(\"fetch marker2\");\n\n      const text = await response.text(); // Get the raw text of the response\n      console.log(\"Raw response text:\", text);\n\n      // Parse the text as JSON\n      const data = JSON.parse(text);\n      console.log(\"Received data:\", data);\n\n      setSharedMarkers(data);\n      setIsSharedLink(true);\n      setMarkersLoaded(true);\n    } catch (error) {\n      console.error(\"Error fetching group markers:\", error.message);\n      console.error(\"Error details:\", error);\n    }\n  };\n\n  useEffect(() => {\n    const queryParams = new URLSearchParams(window.location.search);\n    const groupId = queryParams.get(\"groupId\");\n\n    console.log(\"Group ID:\", groupId);\n\n    if (groupId) {\n      fetchGroupMarkers(groupId);\n      console.log(\"asd1\");\n    } else {\n      setMarkersLoaded(true);\n      console.log(\"asd2\");\n    }\n  }, []);\n\n  // Function to copy the shareable link to clipboard\n  const copyToClipboard = () => {\n    navigator.clipboard.writeText(shareableLink).then(\n      () => {\n        // Optional: Display a message or change button text/state to indicate the link was copied\n      },\n      (err) => {\n        console.error(\"Could not copy text: \", err);\n      }\n    );\n  };\n\n  // Modal\n  const ShareModal = () => (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-[1007] \">\n      <div className=\"bg-white p-4 rounded-lg shadow-lg flex flex-col items-center\">\n        <p>Here's your shareable link:</p>\n        <input\n          type=\"text\"\n          readOnly\n          value={shareableLink}\n          className=\"text-center p-2 border border-gray-300 rounded mt-2\"\n          onClick={(e) => e.target.select()}\n        />\n        <div className=\"flex gap-3 mt-3\">\n          <button\n            className=\"px-4 py-2 my-auto  bg-blue-500 text-white rounded hover:bg-blue-700\"\n            onClick={copyToClipboard}\n          >\n            Copy\n          </button>\n          <button\n            className=\"px-4 py-2 my-auto  bg-blue-500 text-white rounded hover:bg-blue-700\"\n            onClick={() => setShowModal(false)}\n          >\n            Close\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n\n  return (\n    <>\n      {showModal && <ShareModal />}\n      {isMobile ? (\n        <>\n          <button\n            onClick={sendMarkerData}\n            className={`send-button ${\n              mapArray.length === 0 ? \"hidden\" : \"visible\"\n            } text-xs px-3 text-center my-auto py-2 rounded-full share-button-mobile`}\n          >\n            Share tags!\n          </button>\n        </>\n      ) : (\n        <>\n          {!isSharedLink && (\n            <div className=\"flex justify-center\">\n              <button\n                className=\"share-button-mobile body-font  text-xl backdrop-blur-xl flex px-5 py-4\n                 rounded-full fixed mb-10 p4 bottom-2 mx-auto hover:bg-gray-400 \"\n                onClick={sendMarkerData}\n              >\n                Share tags!\n              </button>\n            </div>\n          )}\n        </>\n      )}\n    </>\n  );\n}\n\nexport default ButtonShareMarkers;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}