{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import\"leaflet/dist/leaflet.css\";import{useSharedState}from\"../../SharedContext.jsx\";import{Routes,Route}from\"react-router-dom\";import{DeleteMarker}from\"./Map.jsx\";import{maxAmmountOfTags}from\"./Map.jsx\";import ViewMobileMain from\"./ViewMobile.jsx\";import ViewDesktopMain from\"./ViewDesktop.jsx\";import LoginForm from\"../auth/LoginForm.jsx\";import NotFoundPage from\"./NotFoundPage.jsx\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function MainPage(){const[isModalOpen,setIsModalOpen]=useState(false);const[modalContent,setModalContent]=useState(\"\");const[editIndex,setEditIndex]=useState(0);const{markers,setMarkers}=useSharedState();const{markerIndex,setMarkerIndex}=useSharedState();const{isMobile}=useSharedState();// eslint-disable-next-line no-unused-vars\nconst{sharedMarkers,setSharedMarkers}=useSharedState();const{mapArray,setMapArray}=useSharedState();const{isSharedLink,setIsSharedLink}=useSharedState();const{isLoggedIn,setIsLoggedIn}=useSharedState();useEffect(()=>{// Check if user is logged in\nconst token=localStorage.getItem(\"token\");if(token){setIsLoggedIn(true);}// Check if the URL includes \"share\" to determine if it's a shared link\nconst checkIfSharedLink=()=>{const urlContainsShare=window.location.href.includes(\"shared-markers?groupId\");setIsSharedLink(urlContainsShare);};checkIfSharedLink();},[setIsSharedLink]);function handleDeleteClick(_,index){const newArray=[...mapArray];newArray.splice(index,1);setMapArray(newArray);setMarkers(index);DeleteMarker(markers,setMarkers,index);setMarkerIndex(newArray.length+1);updateMarkersAfterRemoval(index);function updateMarkersAfterRemoval(removedIndex){for(let i=0;i<=maxAmmountOfTags;i++){const markerElement=document.getElementById(\"marker-\".concat(i));if(markerElement){const currentMarkerNumber=parseInt(markerElement.id.replace(\"marker-\",\"\"),10);if(currentMarkerNumber>removedIndex){markerElement.textContent=currentMarkerNumber-1;markerElement.id=\"marker-\".concat(currentMarkerNumber-1);}}}}// Update shared after delete\nsetSharedMarkers(prevSharedMarkers=>{// Create a new array excluding the item at the specified index\nconst filteredMarkers=prevSharedMarkers.filter((_,itemIndex)=>itemIndex!==index);return filteredMarkers;});}function handleMapClicks(index,info){setMapArray(prevMapArray=>[...prevMapArray,info]);}function CloseModalWindow(){setIsModalOpen(false);setModalContent(\"\");}function ModalEditSubmit(){if(editIndex>=0&&editIndex<mapArray.length){let EditElement=document.querySelector(\".button-\".concat(editIndex));if(EditElement){EditElement.textContent=modalContent;}mapArray[editIndex]=modalContent;}setIsModalOpen(false);setSharedMarkers(prevSharedMarkers=>{if(prevSharedMarkers.length===0)return[];const updatedMarkers=[...prevSharedMarkers];updatedMarkers[editIndex]={...prevSharedMarkers[editIndex],info:modalContent};return updatedMarkers;});setModalContent(\"\");}function handleEditClick(index){setEditIndex(index);setIsModalOpen(true);}const viewProps={isModalOpen,CloseModalWindow,ModalEditSubmit,modalContent,setModalContent,handleMapClicks,mapArray,markerIndex,handleEditClick,handleDeleteClick};if(!isLoggedIn&&!isSharedLink){return/*#__PURE__*/_jsx(LoginForm,{});}return/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:isMobile?/*#__PURE__*/_jsx(ViewMobileMain,{...viewProps}):/*#__PURE__*/_jsx(ViewDesktopMain,{...viewProps})}),/*#__PURE__*/_jsx(Route,{path:\"/shared-markers\",element:isMobile?/*#__PURE__*/_jsx(ViewMobileMain,{...viewProps}):/*#__PURE__*/_jsx(ViewDesktopMain,{...viewProps})}),/*#__PURE__*/_jsx(Route,{path:\"*\",element:/*#__PURE__*/_jsx(NotFoundPage,{})})]});//return isMobile ? <ViewMobileMain {...viewProps} /> : <ViewDesktopMain {...viewProps} />;\n}export default MainPage;","map":{"version":3,"names":["React","useState","useEffect","useSharedState","Routes","Route","DeleteMarker","maxAmmountOfTags","ViewMobileMain","ViewDesktopMain","LoginForm","NotFoundPage","jsx","_jsx","jsxs","_jsxs","MainPage","isModalOpen","setIsModalOpen","modalContent","setModalContent","editIndex","setEditIndex","markers","setMarkers","markerIndex","setMarkerIndex","isMobile","sharedMarkers","setSharedMarkers","mapArray","setMapArray","isSharedLink","setIsSharedLink","isLoggedIn","setIsLoggedIn","token","localStorage","getItem","checkIfSharedLink","urlContainsShare","window","location","href","includes","handleDeleteClick","_","index","newArray","splice","length","updateMarkersAfterRemoval","removedIndex","i","markerElement","document","getElementById","concat","currentMarkerNumber","parseInt","id","replace","textContent","prevSharedMarkers","filteredMarkers","filter","itemIndex","handleMapClicks","info","prevMapArray","CloseModalWindow","ModalEditSubmit","EditElement","querySelector","updatedMarkers","handleEditClick","viewProps","children","path","element"],"sources":["/home/jonas/web-projects/trash-tagger/frontend/src/components/view/MainPage.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport \"leaflet/dist/leaflet.css\";\nimport { useSharedState } from \"../../SharedContext.jsx\";\nimport { Routes, Route } from \"react-router-dom\";\nimport { DeleteMarker } from \"./Map.jsx\";\nimport { maxAmmountOfTags } from \"./Map.jsx\";\nimport ViewMobileMain from \"./ViewMobile.jsx\";\nimport ViewDesktopMain from \"./ViewDesktop.jsx\";\nimport LoginForm from \"../auth/LoginForm.jsx\";\nimport NotFoundPage from \"./NotFoundPage.jsx\";\n\nfunction MainPage() {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [modalContent, setModalContent] = useState(\"\");\n  const [editIndex, setEditIndex] = useState(0);\n  const { markers, setMarkers } = useSharedState();\n  const { markerIndex, setMarkerIndex } = useSharedState();\n  const { isMobile } = useSharedState();\n  // eslint-disable-next-line no-unused-vars\n  const { sharedMarkers, setSharedMarkers } = useSharedState();\n  const { mapArray, setMapArray } = useSharedState();\n  const { isSharedLink, setIsSharedLink } = useSharedState();\n  const { isLoggedIn, setIsLoggedIn } = useSharedState();\n\n  useEffect(() => {\n    // Check if user is logged in\n    const token = localStorage.getItem(\"token\");\n\n    if (token) {\n      setIsLoggedIn(true);\n    }\n\n    // Check if the URL includes \"share\" to determine if it's a shared link\n    const checkIfSharedLink = () => {\n      const urlContainsShare = window.location.href.includes(\"shared-markers?groupId\");\n      setIsSharedLink(urlContainsShare);\n    };\n\n    checkIfSharedLink();\n  }, [setIsSharedLink]);\n\n  function handleDeleteClick(_, index) {\n    const newArray = [...mapArray];\n    newArray.splice(index, 1);\n    setMapArray(newArray);\n    setMarkers(index);\n    DeleteMarker(markers, setMarkers, index);\n\n    setMarkerIndex(newArray.length + 1);\n    updateMarkersAfterRemoval(index);\n\n    function updateMarkersAfterRemoval(removedIndex) {\n      for (let i = 0; i <= maxAmmountOfTags; i++) {\n        const markerElement = document.getElementById(`marker-${i}`);\n        if (markerElement) {\n          const currentMarkerNumber = parseInt(markerElement.id.replace(\"marker-\", \"\"), 10);\n\n          if (currentMarkerNumber > removedIndex) {\n            markerElement.textContent = currentMarkerNumber - 1;\n            markerElement.id = `marker-${currentMarkerNumber - 1}`;\n          }\n        }\n      }\n    }\n\n    // Update shared after delete\n    setSharedMarkers((prevSharedMarkers) => {\n      // Create a new array excluding the item at the specified index\n      const filteredMarkers = prevSharedMarkers.filter((_, itemIndex) => itemIndex !== index);\n      return filteredMarkers;\n    });\n  }\n\n  function handleMapClicks(index, info) {\n    setMapArray((prevMapArray) => [...prevMapArray, info]);\n  }\n\n  function CloseModalWindow() {\n    setIsModalOpen(false);\n    setModalContent(\"\");\n  }\n\n  function ModalEditSubmit() {\n    if (editIndex >= 0 && editIndex < mapArray.length) {\n      let EditElement = document.querySelector(`.button-${editIndex}`);\n      if (EditElement) {\n        EditElement.textContent = modalContent;\n      }\n      mapArray[editIndex] = modalContent;\n    }\n    setIsModalOpen(false);\n\n    setSharedMarkers((prevSharedMarkers) => {\n      if (prevSharedMarkers.length === 0) return [];\n\n      const updatedMarkers = [...prevSharedMarkers];\n\n      updatedMarkers[editIndex] = {\n        ...prevSharedMarkers[editIndex],\n        info: modalContent,\n      };\n\n      return updatedMarkers;\n    });\n\n    setModalContent(\"\");\n  }\n\n  function handleEditClick(index) {\n    setEditIndex(index);\n    setIsModalOpen(true);\n  }\n\n  const viewProps = {\n    isModalOpen,\n    CloseModalWindow,\n    ModalEditSubmit,\n    modalContent,\n    setModalContent,\n    handleMapClicks,\n    mapArray,\n    markerIndex,\n    handleEditClick,\n    handleDeleteClick,\n  };\n\n  if (!isLoggedIn && !isSharedLink) {\n    return <LoginForm />;\n  }\n\n  return (\n    <Routes>\n      <Route path=\"/\" element={isMobile ? <ViewMobileMain {...viewProps} /> : <ViewDesktopMain {...viewProps} />} />\n\n      <Route\n        path=\"/shared-markers\"\n        element={isMobile ? <ViewMobileMain {...viewProps} /> : <ViewDesktopMain {...viewProps} />}\n      />\n\n      <Route path=\"*\" element={<NotFoundPage />} />\n    </Routes>\n  );\n  //return isMobile ? <ViewMobileMain {...viewProps} /> : <ViewDesktopMain {...viewProps} />;\n}\n\nexport default MainPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}